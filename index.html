<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</title>
    <style>
      :root {
        --primary: #2c3e50;
        --secondary: #3498db;
        --success: #27ae60;
        --error: #e74c3c;
        --text: #2c3e50;
        --bg: #f5f6fa;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      /* Ø£Ù†Ù…Ø§Ø· Ø¹Ø§Ù…Ø© */
      body {
        font-family: "Tajawal", sans-serif;
        background: var(--bg);
        min-height: 100vh;
      }

      /* Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© */
      .auth-container {
        max-width: 400px;
        margin: 5rem auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
      }

      /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: var(--primary);
        color: white;
      }

      /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
      .main-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        padding: 2rem;
      }

      /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: center;
      }

      /* Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
      .form-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
      }

      .entry-form {
        background: white;
        width: 90%;
        max-width: 500px;
        margin: 2rem auto;
        padding: 1rem;
        border-radius: 10px;
      }

      /* Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
      body {
        margin-bottom: 80px; /* ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙÙˆØªØ± */
      }

      /* ØªØ«Ø¨ÙŠØª Ø§Ù„ÙÙˆØªØ± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª */
      footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000; /* Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ±Ù‡ ÙÙˆÙ‚ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
      }
      @media (max-width: 768px) {
        .dashboard-header {
          flex-direction: column;
          text-align: center;
          gap: 1rem;
        }

        .data-table th,
        .data-table td {
          padding: 8px;
          font-size: 14px;
        }
      }
      /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
      button {
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      }
      .form-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none; /* Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ù…Ø®ÙÙŠ */
        justify-content: center;
        align-items: center;
        z-index: 1000; /* ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ±Ù‡ ÙÙˆÙ‚ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
      }
      contentSection {
        display: block !important;
        visibility: visible !important;
      }
      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
      button {
        background-color: var(--secondary);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
      }

      button:hover {
        background-color: var(--success);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
      .entry-form {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        max-width: 500px;
        width: 90%;
        text-align: center;
      }

      .entry-form input,
      .entry-form select,
      .entry-form textarea {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }

      .entry-form button {
        width: 100%;
        margin-top: 10px;
      }

      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .data-table th {
        background-color: var(--primary);
        color: white;
        padding: 12px;
      }

      .data-table td {
        padding: 12px;
        border: 1px solid #ddd;
      }

      .data-table tr:hover {
        background-color: #f0f0f0;
        transition: background 0.3s;
      }

      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
      .message-box {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--success);
        color: white;
        padding: 15px;
        border-radius: 6px;
        box-shadow: var(--shadow);
        display: none;
        font-size: 16px;
      }
      /* ØªØ­Ø³ÙŠÙ† ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
      .entry-form {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        max-width: 450px;
        width: 90%;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        text-align: right;
      }

      .form-group label {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .entry-form input,
      .entry-form select,
      .entry-form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }

      .entry-form button {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border-radius: 6px;
      }

      .cancel-btn {
        background-color: var(--error);
      }

      .cancel-btn:hover {
        background-color: #c0392b;
      }

      /* test */
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        max-width: 300px; /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø£Ù‚ØµÙ‰ */
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      /* ØªØ±ÙƒÙŠØ² Ø®Ø§Øµ Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº */
      #amount {
        font-weight: bold;
        border-color: #3498db;
      }

      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
      .form-group input:focus,
      .form-group textarea:focus {
        border-color: #3498db;
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
        outline: none;
      }
      /* test2 */
      .data-table {
        margin-top: 20px;
        margin-bottom: 40px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø³ÙÙ„ÙŠ */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow: hidden; /* Ù„Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¸Ù„Ø§Ù„ */
      }

      /* ØªØ­Ø³ÙŠÙ† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙÙˆÙ */
      .data-table tr:hover {
        background-color: #f8f9fa;
        transform: scale(1.02);
        transition: all 0.2s ease;
      }

      /* ØªØ­Ø³ÙŠÙ† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± 
      button {
        min-width: 120px;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 8px;
      }
        */
      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
      @media (max-width: 768px) {
        .form-group input,
        .form-group select,
        .form-group textarea {
          max-width: 100%;
          font-size: 14px;
        }

        .data-table th,
        .data-table td {
          padding: 8px;
          font-size: 14px;
        }

        button {
          width: 100%;
          margin: 5px 0;
        }
      }

      /* test3 */

      .form-group label::after {
        content: " *";
        color: #e74c3c;
        display: inline-block;
        margin-left: 4px;
      }

      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© */
      .message-box {
        top: 20px;
        right: 20px;
        left: auto;
        transform: none;
        width: auto;
        min-width: 300px;
      }

      /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
      #currentTime {
        font-family: monospace;
        background: rgba(255, 255, 255, 0.1);
        padding: 5px 10px;
        border-radius: 4px;
      }
      /* test4 */
      .loading-message {
        background: var(--secondary) !important;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
        100% {
          opacity: 1;
        }
      }
      /*.search-box {
        padding: 10px;
        border: 2px solid #3498db;
        border-radius: 8px;
        width: 250px;
        margin: 0 10px;
      }*/
      /* ØªØ­Ø³ÙŠÙ† Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
      .search-box {
        padding: 12px;
        border: 2px solid #3498db;
        border-radius: 8px;
        width: 300px;
        transition: all 0.3s;
      }

      .search-box:focus {
        border-color: #2ecc71;
        box-shadow: 0 0 8px rgba(46, 204, 113, 0.3);
      }

      /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« */
      .search-info {
        margin: 15px 0;
        font-size: 14px;
        color: #2c3e50;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 8px;
      }
      /* Ø§Ù„ØªØµÙÙŠØ© */
      .table-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .table-controls button {
        background: #2ecc71;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .table-controls button:hover {
        background: #27ae60;
      }

      /*  total  */

      /* Ø£Ù†Ù…Ø§Ø· ØµÙØ­Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ */
      .summary-section {
        max-width: 800px;
        margin: 2rem auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
      }

      .financial-summary {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }

      .financial-summary th,
      .financial-summary td {
        padding: 15px;
        border: 1px solid #ddd;
        text-align: center;
      }

      .financial-summary th {
        background-color: var(--primary);
        color: white;
      }

      .net-profit {
        font-weight: bold;
        background-color: #e8f5e9 !important;
      }

      .net-profit td {
        color: #2e7d32;
        font-size: 1.1em;
      }
      /*  Ø§Ù†Ù…Ø§Ø· Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©  */
      @media print {
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§ */
        .summary-section button,
        .date-filters,
        header,
        footer,
        .main-buttons {
          display: none !important;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
        .print-only {
          display: block !important;
          font-size: 18px;
          margin-bottom: 20px;
          border-bottom: 2px solid #000;
          padding-bottom: 10px;
        }

        .financial-summary {
          width: 100% !important;
          font-size: 16px;
        }

        .financial-summary th {
          background-color: #f0f0f0 !important;
          color: #000 !important;
        }

        .net-profit td {
          font-weight: bold;
          color: #2e7d32 !important;
        }
      }
      @media print {
        body > :not(.summary-section) {
          page-break-before: avoid; /* Ù…Ù†Ø¹ Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        }
      }
      .financial-summary {
        page-break-inside: avoid; /* Ù…Ù†Ø¹ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª */
      }
    </style>
  </head>
  <body>
    <!-- ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
    <div id="authSection" class="auth-container">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <form id="loginForm">
        <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required />
        <input type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required />
        <button type="submit">Ø¯Ø®ÙˆÙ„</button>
      </form>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="dashboard" style="display: none">
      <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
      <div class="dashboard-header">
        <div id="currentTime"></div>
        <h1>Deals 2 Buy</h1>
        <div>Ù…Ø±Ø­Ø¨Ø§ØŒ <span id="username"></span></div>
      </div>

      <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div class="main-buttons">
        <button onclick="showSection('inputs')">Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</button>
        <button onclick="showSection('expenses')">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
        <button onclick="showSection('total')">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</button>
        <input
          type="text"
          id="searchInput"
          placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..."
          onkeyup="handleSearch()"
          style="padding: 10px; border-radius: 8px; border: 1px solid #ddd"
        />
      </div>
      <div class="date-filters">
        <div>ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® :</div>
        <label for="reportStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
        <input type="date" id="startDate" class="date-input" />
        <label for="reportStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
        <input type="date" id="endDate" class="date-input" />
        <button onclick="applyDateFilter()">ğŸ” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ©</button>
        <button onclick="clearDateFilter()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</button>
      </div>
      <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª -->
      <div id="contentSection"></div>
    </div>

    <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
    <footer>Â© Ibrahim Smahin 2025</footer>

    <script>
      // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† HTML
      window.showForm = showForm;
      window.closeForm = closeForm;
      window.submitForm = submitForm;

      // ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØªØ³
      const API_URL =
        "https://script.google.com/macros/s/AKfycbx0Ml1znLvTbEQK3w34RCzhamE3bbRDCP-uBBzUNaGGKF-bbjaLI4b94CTSecIBGVRL3A/exec";

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      let currentStartDate = null; // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯
      let currentEndDate = null; // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯
      let currentUser = null;
      let currentSearchTerm = "";
      let records = {
        inputs: [],
        expenses: [],
      };

      // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const username = e.target[0].value;
          const password = e.target[1].value;

          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„API)
          if (username === "admin" && password === "admin123") {
            currentUser = username;
            document.getElementById("authSection").style.display = "none";
            document.getElementById("dashboard").style.display = "block";
            document.getElementById("username").textContent = username;
            startClock();
            loadData();
            startAutoRefresh();
          }
        });
      function handleSearch() {
        const searchTerm = document.getElementById("searchInput").value;
        currentSearchTerm = searchTerm.toLowerCase();
        showSection(currentSection); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      }

      function applyDateFilter() {
        // 1. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
        currentStartDate = document.getElementById("startDate").value;
        currentEndDate = document.getElementById("endDate").value;

        // 2. Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ (Ù„Ù„Øª debug)
        console.log("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:", currentStartDate);
        console.log("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:", currentEndDate);
        if (
          currentStartDate &&
          currentEndDate &&
          currentStartDate > currentEndDate
        ) {
          alert("âš ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©!");
          return;
        }
        // 3. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ©
        showSection(currentSection);
      }

      function clearDateFilter() {
        document.getElementById("startDate").value = "";
        document.getElementById("endDate").value = "";
        currentStartDate = null;
        currentEndDate = null;
        showSection(currentSection);
      }
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      async function loadData() {
        try {
          showMessage("ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...", "loading");
          const response = await fetch(`${API_URL}?action=getAll`);
          const data = await response.json();

          records.inputs = data.inputs || [];
          records.expenses = data.expenses || [];
          showSection(currentSection);
          updateTables();
          showMessage("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "success");
        } catch (error) {
          showMessage("âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
          console.error("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        }
      }
      // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª
      function startClock() {
        setInterval(() => {
          const options = {
            timeZone: "Asia/Gaza",
            hour12: true,
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          };

          document.getElementById("currentTime").textContent =
            new Date().toLocaleString("en-CA", options);
        }, 1000);
      }

      // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
      function addRecord(type, data) {
        const newRecord = {
          id: generateId(),
          ...data,
          date: getFormattedDate(),
        };

        records[type].push(newRecord);
        updateTables();
        saveToGoogleSheets(type, newRecord);
      }

      function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      }

      // ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØªØ³
      async function saveToGoogleSheets(type, data) {
        const formData = new FormData();
        formData.append("action", "addRecord");
        formData.append("type", type);
        formData.append("data", JSON.stringify(data));

        await fetch(API_URL, {
          method: "POST",
          body: formData,
        });
      }

      // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      let currentSection = "inputs"; // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¯Ø§Ù„Ø©

      function showSection(section) {
        currentSection = section; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        let content = "";

        switch (section) {
          case "inputs":
            content = `
               <br> <button onclick="showForm('inputs')">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø®Ù„</button>
                <button onclick="exportFilteredToExcel('inputs')">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                ${renderTable("inputs")}
            `;
            break;
          case "expenses":
            content = `
                <button onclick="showForm('expenses')">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
                <button onclick="exportFilteredToExcel('expenses')">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                ${renderTable("expenses")}
            `;
            break;
          case "total":
            content = renderSummary();
            break;
        }

        document.getElementById("contentSection").innerHTML = content;
      }

      function renderTable(type) {
        const searchTerm = currentSearchTerm.toLowerCase();
        const originalData = records[type] || [];

        const filteredData = originalData.filter((record) => {
          // Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù†ØµÙŠØ©
          const textMatch =
            String(record.id).toLowerCase().includes(searchTerm) ||
            String(record.amount).toLowerCase().includes(searchTerm) ||
            String(record.paymentType || "")
              .toLowerCase()
              .includes(searchTerm) ||
            String(record.chequeNumber || "")
              .toLowerCase()
              .includes(searchTerm) ||
            String(record.chequeDate || "")
              .toLowerCase()
              .includes(searchTerm) ||
            String(record.description || "")
              .toLowerCase()
              .includes(searchTerm);

          // Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
          const dateMatch = checkDateFilter(record.date);

          return textMatch && dateMatch;
        });
        const totalAmount = filteredData.reduce((sum, record) => {
          return sum + (parseFloat(record.amount) || 0);
        }, 0);

        // 3. Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        let message = "";
        if (filteredData.length === 0) {
          message =
            originalData.length === 0
              ? "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©"
              : "ğŸ” Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬";
        }

        return `
        <!-- Ø¨Ø¯Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
        ${message ? `<div class="message-box">${message}</div>` : ""}
        
        <!-- Ù‚Ø³Ù… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø« -->
        <div class="search-stats">
            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${filteredData.length}</span><br>
            <span> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalAmount.toFixed(2)}</span><br>
            ${
              currentSearchTerm
                ? `<span>  ØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${currentSearchTerm}"</span>`
                : ""
            }
        </div>

        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹Ø©</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ±Ù</th>
                    <th>Ø§Ù„ÙˆØµÙ</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                </tr>
            </thead>
            <tbody>
                ${filteredData
                  .map((record) => {
                    const formattedDate = record.date
                      ? new Date(record.date)
                          .toLocaleString("en-CA", {
                            timeZone: "Asia/Gaza",
                            year: "numeric",
                            month: "2-digit",
                            day: "2-digit",
                            // hour: "2-digit",
                            //  minute: "2-digit",
                          })
                          .replace(/\//g, "-")
                      : "-";

                    return `
                        <tr>
                            <td>${record.id}</td>
                            <td>${record.amount}</td>
                            <td>${record.paymentType || "-"}</td>
                            <td>${record.chequeNumber || "-"}</td>
                            <td>${record.chequeDate || "-"}</td>
                            <td>${record.description}</td>
                            <td>${formattedDate}</td>
                        </tr>
                    `;
                  })
                  .join("")}
            </tbody>
        </table>
    `;
      }

      function checkDateFilter(recordDateStr) {
        if (!currentStartDate && !currentEndDate) return true;

        try {
          const recordDate = parseArabicDate(recordDateStr);
          const startDate = currentStartDate
            ? new Date(currentStartDate)
            : null;
          const endDate = currentEndDate ? new Date(currentEndDate) : null;

          // Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª Ù„ØªØ´Ù…Ù„ Ø§Ù„ÙŠÙˆÙ… ÙƒØ§Ù…Ù„Ù‹Ø§
          if (startDate) startDate.setHours(0, 0, 0, 0);
          if (endDate) endDate.setHours(23, 59, 59, 999);

          return (
            (!startDate || recordDate >= startDate) &&
            (!endDate || recordDate <= endDate)
          );
        } catch (error) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®:", recordDateStr, error);
          return false;
        }
      }

      function parseArabicDate(dateStr) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨ØªÙ†Ø³ÙŠÙ‚ ISO
        if (dateStr.match(/^\d{4}-\d{2}-\d{2}/)) {
          return new Date(dateStr);
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¨ÙŠ
        const arabicToEnglish = {
          "Ù ": "0",
          "Ù¡": "1",
          "Ù¢": "2",
          "Ù£": "3",
          "Ù¤": "4",
          "Ù¥": "5",
          "Ù¦": "6",
          "Ù§": "7",
          "Ù¨": "8",
          "Ù©": "9",
        };

        const converted = dateStr.replace(/[Ù -Ù©]/g, (m) => arabicToEnglish[m]);
        const [day, month, year] = converted.split(/[/-]/).map(Number);
        return new Date(year, month - 1, day);
      }

      function exportToExcel(type) {
        const data = records[type];
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, `${type}_export.xlsx`);
      }
      function printFinancialReport() {
        const startDate = document.getElementById("reportStartDate").value;
        const endDate = document.getElementById("reportEndDate").value;

        if (!startDate || !endDate) {
          alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹");
          return;
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
        document.getElementById("printDates").innerHTML = `
        <p>Ø§Ù„ÙØªØ±Ø© Ù…Ù†: <strong>${startDate}</strong> Ø¥Ù„Ù‰ <strong>${endDate}</strong></p>
    `;

        // ØªØ´ØºÙŠÙ„ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        window.print();
      }

      function renderSummary() {
        return `
        <div class="summary-section">
            <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>

            <div class="date-filters">
                <label for="reportStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                <input type="date" id="reportStartDate" class="date-input">
                <label for="reportStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                <input type="date" id="reportEndDate" class="date-input">
                <button onclick="calculateFinancialSummary()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            </div>
    <div id="printDates" class="print-only"></div>

            <table class="financial-summary">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¨Ù†Ø¯</th>
                        <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</td>
                        <td id="totalInputs">-</td>
                    </tr>
                    <tr>
                        <td>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</td>
                        <td id="totalExpenses">-</td>
                    </tr>
                    <tr class="net-profit">
                        <td>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</td>
                        <td id="netTotal">-</td>
                    </tr>
                </tbody>
            </table>
                           <br> <button onclick="printFinancialReport()" class="print-btn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

        </div>
    `;
      }

      function calculateFinancialSummary() {
        const startDate = document.getElementById("reportStartDate").value;
        const endDate = document.getElementById("reportEndDate").value;

        if (!startDate || !endDate) {
          alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©");
          return;
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        const totalInputs = calculateTotal("inputs", startDate, endDate);
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
        const totalExpenses = calculateTotal("expenses", startDate, endDate);
        // ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­
        const netProfit = totalInputs - totalExpenses;

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        document.getElementById("totalInputs").textContent =
          totalInputs.toFixed(2);
        document.getElementById("totalExpenses").textContent =
          totalExpenses.toFixed(2);
        document.getElementById("netTotal").textContent = netProfit.toFixed(2);
      }

      function calculateTotal(type, startDate, endDate) {
        return records[type].reduce((sum, record) => {
          const recordDate = parseArabicDate(record.date);
          const start = new Date(startDate);
          const end = new Date(endDate);

          start.setHours(0, 0, 0, 0);
          end.setHours(23, 59, 59, 999);

          if (recordDate >= start && recordDate <= end) {
            return sum + (parseFloat(record.amount) || 0);
          }
          return sum;
        }, 0);
      }

      // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
      function showForm(type) {
        const localDate = new Date(Date.now() + 2 * 60 * 60 * 1000);
        const formHTML = `
    <div class="form-overlay" onclick="closeForm()">
        <div class="entry-form" onclick="event.stopPropagation()"> 
            <h3>${type === "inputs" ? "Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø®Ù„" : "Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ"}</h3>
            <form onsubmit="submitForm(event, '${type}')">
                
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
                    <input type="number" id="amount" required>
                </div>

                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹Ø©:</label>
                    <select id="paymentType" onchange="toggleChequeFields()">
                        <option value="Ù†Ù‚Ø¯ÙŠ">Ù†Ù‚Ø¯ÙŠ</option>
                        <option value="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
                        <option value="Ø´ÙŠÙƒ">Ø´ÙŠÙƒ</option>
                    </select>
                </div>

                <div id="chequeFields" style="display: none;">
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ:</label>
                        <input type="text" id="chequeNumber">
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ±Ù:</label>
                        <input type="date" id="chequeDate">
                    </div>
                </div>

                <div class="form-group">
                    <label>Ø§Ù„ÙˆØµÙ:</label>
                    <textarea id="description" rows="3"></textarea>
                </div>

               

                <button type="submit">ğŸ’¾ Ø­ÙØ¸</button>
                <button type="button" class="cancel-btn" onclick="closeForm()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
            </form>
        </div>
    </div>
    `;
        document.body.insertAdjacentHTML("beforeend", formHTML);
        document.querySelector(".form-overlay").style.display = "flex";
      }

      // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø´ÙŠÙƒ
      function toggleChequeFields() {
        const paymentType = document.getElementById("paymentType").value;
        const chequeFields = document.getElementById("chequeFields");
        chequeFields.style.display = paymentType === "Ø´ÙŠÙƒ" ? "block" : "none";
      }

      // Ø¯Ø§Ù„Ø© Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      function closeForm() {
        const formOverlay = document.querySelector(".form-overlay");
        if (formOverlay) {
          formOverlay.style.opacity = "0";
          setTimeout(() => formOverlay.remove(), 300);
        }
      }

      // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      async function submitForm(event, type) {
        event.preventDefault();

        const amount = document.getElementById("amount").value;
        const paymentType = document.getElementById("paymentType").value;
        const chequeNumber =
          document.getElementById("chequeNumber")?.value || "";
        const chequeDate = document.getElementById("chequeDate")?.value || "";
        const description = document.getElementById("description").value;

        // Ø¥Ù†Ø´Ø§Ø¡ ØªØ§Ø±ÙŠØ® Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©
        const now = new Date();
        //const localDate = new Date(now.getTime() + now.getTimezoneOffset() * 60 * 1000);
        // Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø·Ø±Ø­ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§
        const localDate = new Date(Date.now() + 2 * 60 * 60 * 1000);

        const newRecord = {
          id: Date.now().toString(),
          amount: amount,
          paymentType: paymentType,
          chequeNumber: chequeNumber,
          chequeDate: chequeDate,
          description: description,
          date: localDate.toISOString(), // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© ISO
          //date: now.toISOString(),
        };

        try {
          showMessage("â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...", "loading");

          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ±
          const formData = new FormData();
          formData.append("action", "addRecord");
          formData.append("type", type);
          formData.append("data", JSON.stringify(newRecord));

          await fetch(API_URL, {
            method: "POST",
            body: formData,
          });

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          records[type].push(newRecord);
          updateTables();
          closeForm();
          showMessage("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!", "success");
        } catch (error) {
          showMessage("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message, "error");
        }
      }

      // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
      function updateTables() {
        if (currentSection === "inputs" || currentSection === "expenses") {
          showSection(currentSection);
        }
      }

      function showMessage(message, type = "success") {
        let color;
        if (type === "success") color = "var(--success)";
        else if (type === "error") color = "var(--error)";
        else color = "var(--secondary)"; // Loading

        let messageBox = document.getElementById("messageBox");
        if (!messageBox) {
          messageBox = document.createElement("div");
          messageBox.id = "messageBox";
          messageBox.className = "message-box";
          document.body.appendChild(messageBox);
        }

        messageBox.textContent = message;
        messageBox.style.background = color;
        messageBox.style.display = "block";

        setTimeout(() => {
          messageBox.style.display = "none";
        }, 3000);
      }
      function getFormattedDate() {
        const now = new Date();
        return now.toISOString(); // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© ISO
      }
      // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      function startAutoRefresh() {
        setInterval(() => {
          if (currentUser) {
            // ØªØ­Ø¯ÙŠØ« ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            console.log("ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§...");
            loadData();
          }
        }, 90000); // 60 Ø«Ø§Ù†ÙŠØ© = 1 Ø¯Ù‚ÙŠÙ‚Ø©
      }

      // Ø£Ø¶Ù Ù‡Ø°Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„Ù€ script
      // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      function filterTable() {
        currentSearchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        showSection(currentSection);
      }

      // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
      function searchRecords(records) {
        return records.filter((record) => {
          return Object.values(record).some((value) =>
            String(value).toLowerCase().includes(searchTerm)
          );
        });
      }

      let searchTimeout;

      function filterTable() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchTerm = document
            .getElementById("searchInput")
            .value.toLowerCase();
          showSection(currentSection);
        }, 3000); // ØªØ£Ø®ÙŠØ± 300ms
      }
      function exportFilteredToExcel(type) {
        // 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµÙØ§Ø©
        const searchTerm = currentSearchTerm.toLowerCase();
        const originalData = records[type] || [];

        const filteredData = originalData.filter((record) => {
          // Ù†ÙØ³ Ø´Ø±ÙˆØ· Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ renderTable
          const textMatch =
            String(record.id).toLowerCase().includes(searchTerm) ||
            String(record.amount).toLowerCase().includes(searchTerm) ||
            String(record.paymentType || "")
              .toLowerCase()
              .includes(searchTerm) ||
            String(record.chequeNumber || "")
              .toLowerCase()
              .includes(searchTerm) ||
            String(record.chequeDate || "")
              .toLowerCase()
              .includes(searchTerm) ||
            String(record.description || "")
              .toLowerCase()
              .includes(searchTerm);

          const dateMatch = checkDateFilter(record.date);
          return textMatch && dateMatch;
        });

        // 2. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel
        const worksheet = XLSX.utils.json_to_sheet(filteredData);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        // 3. ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
        const date = new Date().toISOString().split("T")[0];
        XLSX.writeFile(workbook, `${type}_${date}.xlsx`);
      }
    </script>
  </body>
</html>
